<%= javascript_include_tag "games" %>
<%= stylesheet_link_tag    "games" %>

<%= content_tag :div, id: "game-data", data: {game: @game.to_json(:include => :moves), userid: current_user.id, ships: @game.ships.to_json(:include => :shiptype)} do %>
<% end %>
<div style="display:flex;justify-content:center;align-content:flex-start;">
  <div id="message_stream" style="height:700px;width:300px;display:inline-block;background-color:#dfdfdf;"></div>
  <canvas id="myCanvas" width="700" height="630" style="display:inline-block;margin-left:0px;margin-right:0px;"></canvas>
  <%= image_tag (image_url "boats.jpg" ) %>
</div>
<div class='text-center'><a class='btn btn-danger' href='<%= game_forfeit_path %>'>Forfeit</a></div>

<script>

  var dispatcher = new WebSocketRails(window.location.host + "/websocket", true)

  var canvas = document.getElementById('myCanvas');
  var ctx = canvas.getContext('2d');
  var N = 30;
  var HEIGHT = canvas.height-30
  var WIDTH = canvas.height-30 //make it square
  var BAR_WIDTH = canvas.width-HEIGHT
  var TEXT_BAR_WIDTH = canvas.height-600
  var SQ_WIDTH = Math.floor(WIDTH/N)
  var GAME_DATA = $('#game-data').data("game")
  var USERID = $('#game-data').data("userid")
  var pid = ((USERID == GAME_DATA.player_1_id) ? Turn.First : Turn.Second)
  var SHIPS = $('#game-data').data("ships")

  // game logistics
  var game = new Game();
  
  setInterval(function () {
    game.Display();
  }, 36);

</script>
